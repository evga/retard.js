function t(t,e){if(!t)throw new Error(e??"assert fail")}class e{constructor(){this.cnt=0,this.sum=0,this.vmin=null,this.vmax=null,this.avg=0}counter(){this.cnt++}update(t){this.cnt++,this.sum+=t,this.vmin=null===this.vmin?t:Math.min(t,this.vmin),this.vmax=null===this.vmax?t:Math.max(t,this.vmax),this.avg=this.cnt>0?this.sum/this.cnt:0}}const n=new class{#t=[];constructor(){}push(t){this.#t.push(t)}pop(){if(0===this.#t.length)throw new Error("unbalanced stack");return this.#t.pop()}get length(){return this.#t.length}get current(){return this.#t[this.#t.length-1]}};var i=!0;const s=Symbol("stop"),r=[];class a{#e=!1;description;userCallback;constructor(n){t(n instanceof Function),this.callback=n,i&&(this.executeStats=new e,r.push(this))}stop(){this.#e=!0}execute(...t){const e=performance.now();if(this.#e)return s;n.push(this);try{return this.callback(...t)}finally{n.pop(),this.executeStats&&this.executeStats.update(performance.now()-e)}}}function o(t){return new a(t)}const c=[];class l{constructor(t){this.initialValue=t,this.value=t,this.callbacks=new Set,this.resetBound=this.reset.bind(this),i&&(this.readStats=new e,this.writeStats=new e,this.changedStats=new e,c.push(this))}capture(){n.current&&this.callbacks.add(n.current)}reset(){this.value=this.initialValue,this.changed()}read(){return this.readStats&&this.readStats.counter(),this.capture(),this.value}write(t,{force:e=!1}={}){if(n.length>0)throw new Error("write used inside a reactive callback");return this.writeStats&&this.writeStats.counter(),(this.value!==t||e)&&(this.value=t,this.changed()),this.value}changed(){const t=performance.now(),e=[];for(const t of this.callbacks)t.execute()===s&&e.push(t);for(const t of e)this.callbacks.delete(t);this.changedStats&&this.changedStats.update(performance.now()-t)}toString(){return this.capture(),String(this.value)}}function u(t){return new l(t)}function h(e,n){t(e instanceof Element),t(n instanceof l),e instanceof HTMLInputElement?function(t,e){const n=()=>`${t.tagName}[type=${t.type}].bind(${e})`;if(t.matches('[type="checkbox"]')){const i=()=>e.write(t.checked),s=()=>t.checked=e.read();t.addEventListener("change",i);const r=new a(s);r.description=n,r.execute()}else{const i=()=>e.write(t.value),s=()=>t.value=e.read();t.addEventListener("input",i);const r=new a(s);r.description=n,r.execute()}}(e,n):e instanceof HTMLSelectElement&&function(t,e){const n=()=>`${t.tagName}.bind(${e})`;if(t.multiple);else{const i=()=>e.write(t.value),s=()=>t.value=e.read();t.addEventListener("change",i);const r=new a(s);r.description=n,r.execute()}}(e,n)}class p{constructor(e,n){t(e instanceof Element),t(Array.isArray(n)),this.element=e,this.initialChildCount=e.childNodes.length,this.childs=n.flat(1/0).map((t=>"function"==typeof t?new d(this,t):t)),this.#n()}#n(){for(const t of this.childs)t instanceof d?t.callback.execute():t&&t.container instanceof p?this.element.append(t.container.element):this.element.append(t);this.check()}#i(){return this.childs.reduce(((t,e)=>t+(e instanceof d?e.clen:1)),this.initialChildCount)}check(){const t=this.element.childNodes.length,e=this.#i();if(t!==e)throw new Error(`element desync current=${t} render=${e}`)}}class d{constructor(t,e){this.container=t,this.userCallback=e,this.firstInvocation=!0,this.clen=0,this.callback=new a((()=>this.#s())),this.callback.userCallback=e}#r(){let t=this.container.element.firstChild;if(null===t)return null;let e=this.container.initialChildCount;for(;e--;){if(null===t)throw new Error("child expected");t=t.nextSibling}e=0;for(const n of this.container.childs){if(n===this){for(;e--;){if(null===t)throw new Error("child expected");t=t.nextSibling}return t}e+="function"==typeof n?n.clen:1}throw new Error("function not found")}#s(){t(this instanceof d),this.firstInvocation||this.container.check();let e=this.clen;const n=[this.userCallback()].flat(1/0);this.clen=n.length;for(let t=0;t<n.length;t++)n[t]&&n[t].container instanceof p&&(n[t]=n[t].container.element);if(this.firstInvocation)this.firstInvocation=!1,n.length>0&&this.container.element.append(...n);else{let t=this.#r();if(null===t)this.container.element.append(...n);else{for(;e--;){if(null===t)throw new Error("child expected");const e=t;if(t=t.nextSibling,null===e.parentNode)throw new Error("parentNode is null");e.parentNode.removeChild(e)}if(n.length>0)if(null===t)this.container.element.append(...n);else{if(null===t.parentNode)throw new Error("parentNode is null");for(const e of n)e instanceof Node?t.parentNode.insertBefore(e,t):t.parentNode.insertBefore(document.createTextNode(e),t)}}}}}const f=new RegExp("^<(\\w+)>$"),m=new RegExp("^(\\w+)\\[(\\w+)=(\\w+)]$");class b{constructor(e,n){t(e instanceof Element),t(Array.isArray(n)),this.container=new p(e,n)}get element(){return this.container.element}attr(e){t("object"==typeof e);for(const t in e)this.element.setAttribute(t,e[t]);return this}bind(t){return h(this.element,t),this}on(t,e,n){if("string"==typeof t&&"function"==typeof e){const i=f.exec(t);i&&(t=`keydown[key=${i[1]}]`);const s=m.exec(t);if(s){const t=s[1],i=s[2],r=s[3];this.element.addEventListener(t,(function(t){t[i]&&t[i]==r&&e.call(this,t)}),n)}else this.element.addEventListener(t,e,n)}else this.element.addEventListener(t,e,n);return this}}function w(e,n){return t("string"==typeof e),t(e.length>0),function(...t){const i=document.createElement(e),s=new b(i,t);return n&&s.attr(n),s}}function g(t){return(...e)=>new b(t,e)}function y(t){if("string"==typeof t){if(t.startsWith("#")){const e=document.getElementById(t.slice(1));if(null===e)throw new Error("element not found");return g(e)}return w(t)}if(t instanceof Element)return g(t);throw new Error("invalid argument")}y.a=w("a"),y.abbr=w("abbr"),y.address=w("address"),y.area=w("area"),y.article=w("article"),y.aside=w("aside"),y.audio=w("audio"),y.b=w("b"),y.base=w("base"),y.bdi=w("bdi"),y.bdo=w("bdo"),y.blockquote=w("blockquote"),y.body=w("body"),y.br=w("br"),y.button=w("button"),y.canvas=w("canvas"),y.caption=w("caption"),y.cite=w("cite"),y.code=w("code"),y.col=w("col"),y.colgroup=w("colgroup"),y.data=w("data"),y.datalist=w("datalist"),y.dd=w("dd"),y.del=w("del"),y.details=w("details"),y.dfn=w("dfn"),y.dialog=w("dialog"),y.div=w("div"),y.dl=w("dl"),y.dt=w("dt"),y.em=w("em"),y.embed=w("embed"),y.fieldset=w("fieldset"),y.figcaption=w("figcaption"),y.figure=w("figure"),y.footer=w("footer"),y.form=w("form"),y.h1=w("h1"),y.h2=w("h2"),y.h3=w("h3"),y.h4=w("h4"),y.h5=w("h5"),y.h6=w("h6"),y.head=w("head"),y.header=w("header"),y.hgroup=w("hgroup"),y.hr=w("hr"),y.html=w("html"),y.i=w("i"),y.iframe=w("iframe"),y.img=w("img"),y.input=w("input"),y.ins=w("ins"),y.kbd=w("kbd"),y.label=w("label"),y.legend=w("legend"),y.li=w("li"),y.link=w("link"),y.main=w("main"),y.map=w("map"),y.mark=w("mark"),y.math=w("math"),y.menu=w("menu"),y.meta=w("meta"),y.meter=w("meter"),y.nav=w("nav"),y.noscript=w("noscript"),y.object=w("object"),y.ol=w("ol"),y.optgroup=w("optgroup"),y.option=w("option"),y.output=w("output"),y.p=w("p"),y.picture=w("picture"),y.pre=w("pre"),y.progress=w("progress"),y.q=w("q"),y.rp=w("rp"),y.rt=w("rt"),y.ruby=w("ruby"),y.s=w("s"),y.samp=w("samp"),y.script=w("script"),y.search=w("search"),y.section=w("section"),y.select=w("select"),y.slot=w("slot"),y.small=w("small"),y.source=w("source"),y.span=w("span"),y.strong=w("strong"),y.style=w("style"),y.sub=w("sub"),y.summary=w("summary"),y.sup=w("sup"),y.svg=w("svg"),y.table=w("table"),y.tbody=w("tbody"),y.td=w("td"),y.template=w("template"),y.textarea=w("textarea"),y.tfoot=w("tfoot"),y.th=w("th"),y.thead=w("thead"),y.time=w("time"),y.title=w("title"),y.tr=w("tr"),y.track=w("track"),y.u=w("u"),y.ul=w("ul"),y.var=w("var"),y.video=w("video"),y.wbr=w("wbr"),y.input_hidden=w("input",{type:"hidden"}),y.input_text=w("input",{type:"text"}),y.input_search=w("input",{type:"search"}),y.input_tel=w("input",{type:"tel"}),y.input_url=w("input",{type:"url"}),y.input_email=w("input",{type:"email"}),y.input_password=w("input",{type:"password"}),y.input_date=w("input",{type:"date"}),y.input_month=w("input",{type:"month"}),y.input_week=w("input",{type:"week"}),y.input_time=w("input",{type:"time"}),y.input_datetime_local=w("input",{type:"datetime-local"}),y.input_number=w("input",{type:"number"}),y.input_range=w("input",{type:"range"}),y.input_color=w("input",{type:"color"}),y.input_checkbox=w("input",{type:"checkbox"}),y.input_radio=w("input",{type:"radio"}),y.input_file=w("input",{type:"file"}),y.input_submit=w("input",{type:"submit"}),y.input_image=w("input",{type:"image"}),y.input_reset=w("input",{type:"reset"}),y.input_button=w("input",{type:"button"}),y.IF=function(t){return t instanceof l?(...e)=>()=>t.read()?e:[]:(...e)=>t?e:[]};export{o as newCallback,y as newTag,u as newValue};
